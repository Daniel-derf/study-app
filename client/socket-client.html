<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>WebSocket Timer</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', Arial, sans-serif;
        padding: 0;
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(135deg, #181c2f 0%, #232946 100%);
        color: #f4f4f4;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      h1 {
        margin-bottom: 1rem;
        color: #eebbc3;
        letter-spacing: 1px;
      }

      #timer-container {
        background: #232946;
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px #000a 0.2;
        padding: 2.5rem 3.5rem;
        margin: 2rem 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #timer-label {
        font-size: 1.1rem;
        color: #b8c1ec;
        margin-bottom: 0.5rem;
        letter-spacing: 0.5px;
      }

      #timer {
        font-family: 'Roboto Mono', monospace;
        font-size: 3.5rem;
        color: #eebbc3;
        background: #121629;
        border-radius: 1rem;
        padding: 0.7rem 2.5rem;
        box-shadow: 0 2px 12px #0007;
        letter-spacing: 0.1em;
        margin-bottom: 0.5rem;
        transition: background 0.3s;
      }

      #status {
        font-size: 1rem;
        color: #b8c1ec;
        margin-top: 1rem;
        letter-spacing: 0.5px;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <h1>Relógio de Sessão de Estudo</h1>
    <div id="timer-container">
      <div id="timer-label">Tempo conectado</div>
      <div id="timer">00:00:00</div>
      <div id="status">Conectando...</div>
    </div>
    <script>
      function formatSeconds(sec) {
        const h = String(Math.floor(sec / 3600)).padStart(2, '0');
        const m = String(Math.floor((sec % 3600) / 60)).padStart(2, '0');
        const s = String(sec % 60).padStart(2, '0');
        return `${h}:${m}:${s}`;
      }

      const statusEl = document.getElementById('status');
      const timerEl = document.getElementById('timer');

      const socket = io('http://localhost:3000', {
        transports: ['websocket'],
        query: {
          subjectId: '7ff20338-64d4-4887-8aab-1e8638121b93',
          token:
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4YmYxMDAwZS1jMGM2LTQ4MTMtYWZlYS01MDQ3NTdlNGZhOTYiLCJlbWFpbCI6Im1haWxAbWFpbC5jb20iLCJpYXQiOjE3NTUwODQ3OTAsImV4cCI6MTc1NTE3MTE5MH0.P5XIIH0tzJ65OBRqgUIai0bY_PK5SeIMwBHbdPnh4Y0',
        },
      });

      socket.on('connect', () => {
        statusEl.textContent = 'Conectado ao servidor WebSocket';
        statusEl.style.color = '#43d9ad';
      });

      socket.on('connection-duration', (duration) => {
        timerEl.textContent = formatSeconds(duration);
      });

      socket.on('disconnect', () => {
        statusEl.textContent = 'Desconectado do servidor';
        statusEl.style.color = '#eebbc3';
      });
    </script>
  </body>
</html>
